#####################
# Star Fox Makefile #
#####################

# Assembler
ASM=SASMX
ASMFLAGS=-efilelist=0 -xsymbols.txt

# Linker
LINK=ARGLINK
LOPTS=-b30 -h1024 -t7d

# ROM Extender
EXTEND=EXTEND
EXTOPS= 16 ff

# Checksum Fixer
CHECK=SFCHECK
COPTS=-s -f

# FXGfx Interleaver
MERGE=MERGE
MOPTS= /cgx

ALLFILES= BANK\bank0.sob BANK\bank1.sob BANK\bank2.sob \
 BANK\bank4.sob BANK\bank5.sob BANK\bank6.sob BANK\bank7.sob \
 BANK\bank8.sob BANK\bank9.sob BANK\bank10.sob \
 BANK\bank11.sob BANK\shbanks.sob BANK\incbins.sob

.asm.sob:
	@$(ASM) -m30 $(ASMFLAGS) $< -v$*.SOB

all: msprites allcols crunch sf.rom

# Interleave FXGfx
msprites:
    MSPRITES\msprites.bat
    @$(MERGE) MSPRITES\tex_0.CGX MSPRITES\tex_1.CGX MSPRITES\tex_01.bin $(MOPTS)
    @$(MERGE) MSPRITES\tex_2.CGX MSPRITES\tex_3.CGX MSPRITES\tex_23.bin $(MOPTS)
    @$(MERGE) MSPRITES\tex_2.CGX MSPRITES\tex_3_a.CGX MSPRITES\tex_23_a.bin $(MOPTS)

# Pack Palettes
allcols:
    cd data
    cd col
    pc.bat
	cd ..\..

crunch:
    cd data
	CRUNCH.BAT
	cd ..

sf.rom: $(ALLFILES)
	@$(LINK) $(LOPTS) -osf.rom @flist
    @$(EXTEND) sf.rom $(EXTOPS)
	@$(CHECK) $(COPTS) sf.rom

## Files to assemble
bank0.sob: BANK\bank0.asm

bank1.sob: BANK\bank1.asm

bank2.sob: BANK\bank2.asm

bank4.sob: BANK\bank4.asm

bank5.sob: BANK\bank5.asm

bank6.sob: BANK\bank6.asm

bank7.sob: BANK\bank7.asm

bank8.sob: BANK\bank8.asm

bank9.sob: BANK\bank9.asm

bank10.sob: BANK\bank10.asm

bank11.sob: BANK\bank11.asm

shbanks.sob: BANK\shbanks.asm

incbins.sob: BANK\incbins.asm


